# План интеграции с МойСклад (Excel Import)

## Цель
Автоматическое создание товаров в МойСклад на основе Excel файла.

## Формат Excel
Ожидаемые колонки:
1. **Название** -> `name`
2. **Артикул** -> `article` (Ключ для поиска дубликатов)
3. **Минимальная цена** -> `minPrice`
4. **Розничная цена** -> `salePrices` (Тип цены "Цена продажи")
5. **Страна** -> Поле `country` (Справочник стран)
   *(Поля "Поставщик" и "Предзаказ" убраны из Excel: Предзаказ всегда = 30)*

## Архитектура

### 1. Подготовка (`setup_env.sh`)
- Установка python библиотек: `requests`, `pandas`, `openpyxl`, `python-dotenv`.
- Создание `.env` файла.

### 2. Анализ метаданных (`check_metadata.py`)
- Скрипт для получения ID доп. полей и справочников.
- **Зачем:** API требует UUID для доп. полей (например, "Поставщик" имеет ID `345-sdf-sd...`). Мы не можем передать просто название поля.
- Скрипт выведет список всех полей и стран, чтобы мы могли настроить маппинг.

### 3. Основной скрипт (`import_products.py`)
- **Шаг 1:** Загрузка справочников (Страны, Доп. поля) из API.
- **Шаг 2:** Чтение Excel файла.
- **Шаг 3:** Цикл по строкам:
    - Проверка существования товара по `article`.
    - Если нет -> Создание JSON объекта.
    - **Обработка Страны:** Поиск страны по имени в справочнике -> получение `meta`.
    - **Обработка Цен:** Формирование массива `salePrices` и `minPrice`.
    - **Обработка Доп. полей:** Заполнение `attributes` для Поставщика и Предзаказа.
    - Отправка POST запроса.
    - Логирование результата (Создан/Ошибка/Пропущен).

## Инструкция для пользователя
1. Заполнить `.env` логином и паролем.
2. Запустить `check_metadata.py` чтобы убедиться, что поля "Поставщик" и "Предзаказ" существуют в МойСклад.
3. Положить Excel файл в папку `input/`.
4. Запустить `import_products.py`.
